---
import { getPages } from "../api/directus";
import Layout from "./Layout.astro";
import PageBuilder from "./PageBuilder.astro";
import CustomWidget, { overrideWidgetList } from "./CustomWidgets.astro";

export async function getStaticPaths() {
    try {
        const pagesInfo = await getPages(
            import.meta.env.PUBLIC_ORGANIZATION_ID,
        );

        if (!pagesInfo) {
            throw new Error("No pages found");
        }

        return pagesInfo
            .filter((page) => page.slug !== "index") // Excluir la pÃ¡gina index
            .map((page) => {
                return {
                    params: { slug: page.slug },
                    props: page,
                };
            });
    } catch (error) {
        console.error("Error fetching pages:", error);
        return [];
    }
}
const page = Astro.props;
---

<Layout title={page.title}>
    <PageBuilder
        page={page}
        CustomWidgets={CustomWidget}
        overrideWidgetList={overrideWidgetList}
    />
</Layout>
